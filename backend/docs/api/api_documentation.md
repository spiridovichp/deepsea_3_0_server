# API Документация DeepSea 3.0

## Оглавление

1. [Аутентификация и авторизация](#1-аутентификация-и-авторизация)
2. [Управление пользователями](#2-управление-пользователями)
3. [Управление ролями и разрешениями](#3-управление-ролями-и-разрешениями)
4. [Управление проектами](#4-управление-проектами)
5. [Управление задачами](#5-управление-задачами)
6. [Управление документами](#6-управление-документами)
7. [Управление вопросами от заказчика](#7-управление-вопросами-от-заказчика)
8. [Управление материалами](#8-управление-материалами)
9. [Управление оборудованием](#9-управление-оборудованием)
10. [Управление спецификациями и ведомостями](#10-управление-спецификациями-и-ведомостями)
11. [Управление файлами](#11-управление-файлами)
12. [Коммуникации](#12-коммуникации)
13. [Wiki](#13-wiki)
14. [Справочники](#14-справочники)

---

## Общие требования по разрешениям

Все методы API (кроме методов в разделе "Аутентификация и авторизация") защищены и требуют наличия соответствующего разрешения (permission) у пользователя.

Шаблон соответствия HTTP-методов к кодам разрешений:

- GET (список / получение) → resource.view
- POST (создание) → resource.create
- PUT (обновление) → resource.update
- DELETE (удаление / soft-delete) → resource.delete

Где resource — имя ресурса в URL (например, для `/api/departments` resource = `departments`, следовательно для получения списка требуется `departments.view`, для создания — `departments.create` и т.д.).

Для каждого метода ниже указано требуемое разрешение. Если в конкретной секции в явном виде указано иное требование — используйте его.


## 1. Аутентификация и авторизация

### POST /api/auth/login
**Описание:** Вход в систему

**Запрос:**
```json
{
  "username": "string",
  "password": "string"
}
```

**Ответ:**
```json
{
  "token": "string",
  "refresh_token": "string",
  "expires_at": "2024-01-01T00:00:00Z",
  "user": {
    "id": 1,
    "username": "string",
    "email": "string",
    "first_name": "string",
    "last_name": "string"
  }
}
```

**Ошибки:**
- `400` - Ошибка валидации
- `401` - Неверные учетные данные
- `403` - Пользователь деактивирован
- `500` - Внутренняя ошибка сервера

### POST /api/auth/refresh
**Описание:** Обновление токена

**Запрос:**
```json
{
  "refresh_token": "string"
}
```

**Ответ:**
```json
{
  "token": "string",
  "refresh_token": "string",
  "expires_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `400` - Ошибка валидации
- `401` - Неверный или истекший токен
- `500` - Внутренняя ошибка сервера

### POST /api/auth/logout
**Описание:** Выход из системы

**Ответ:**
```json
{
  "message": "success"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `500` - Внутренняя ошибка сервера

### GET /api/auth/me
**Описание:** Получение информации о текущем пользователе

**Ответ:**
```json
{
  "id": 1,
  "username": "string",
  "email": "string",
  "phone": "string",
  "first_name": "string",
  "last_name": "string",
  "middle_name": "string",
  "department": {
    "id": 1,
    "name": "string"
  },
  "job_title": {
    "id": 1,
    "name": "string"
  },
  "roles": []
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `404` - Пользователь не найден
- `500` - Внутренняя ошибка сервера

---

## 2. Управление пользователями

### GET /api/users
**Описание:** Список пользователей

**Требования:**
- Разрешение: `users.view`

**Параметры запроса:**
- `page` (int)
- `limit` (int)
- `department_id` (int)
- `is_active` (boolean)
- `search` (string)

**Ответ:**
```json
{
  "data": [],
  "total": 0,
  "page": 1,
  "limit": 20
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации параметров
- `500` - Внутренняя ошибка сервера

### GET /api/users/{id}
**Описание:** Получение пользователя

**Требования:**
- Разрешение: `users.view`

**Ответ:**
```json
{
  "id": 1,
  "username": "string",
  "email": "string",
  "phone": "string",
  "first_name": "string",
  "last_name": "string",
  "middle_name": "string",
  "department_id": 1,
  "job_title_id": 1,
  "is_active": true,
  "is_verified": false,
  "last_login": "2024-01-01T00:00:00Z",
  "created_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Пользователь не найден
- `500` - Внутренняя ошибка сервера

### POST /api/create_users
**Описание:** Создание пользователя

**Требования:**
- Разрешение: `users.create`

**Запрос:**
```json
{
  "username": "string",
  "email": "string",
  "phone": "string",
  "password": "string",
  "first_name": "string",
  "last_name": "string",
  "middle_name": "string",
  "department_id": 1,
  "job_title_id": 1
}
```

**Ответ:**
```json
{
  "id": 1,
  "username": "string",
  "email": "string",
  "created_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `404` - Отдел или должность не найдены
- `409` - Пользователь с таким username/email/phone уже существует
- `500` - Внутренняя ошибка сервера

### PUT /api/users/{id}
**Описание:** Обновление пользователя

**Требования:**
- Разрешение: `users.update`

**Запрос:**
```json
{
  "email": "string",
  "phone": "string",
  "first_name": "string",
  "last_name": "string",
  "middle_name": "string",
  "department_id": 1,
  "job_title_id": 1,
  "is_active": true
}
```

**Ответ:**
```json
{
  "id": 1,
  "username": "string",
  "email": "string",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Пользователь не найден
- `400` - Ошибка валидации
- `409` - Email или phone уже используется другим пользователем
- `500` - Внутренняя ошибка сервера

### DELETE /api/users/{id}
**Описание:** Удаление пользователя

**Требования:**
- Разрешение: `users.delete`

**Ответ:**
```json
{
  "message": "success"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Пользователь не найден
- `422` - Невозможно удалить пользователя, есть связанные записи
- `500` - Внутренняя ошибка сервера

### GET /api/departments
**Описание:** Список отделов

**Требования:**
- Разрешение: `departments.view`

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "description": "string",
      "manager_id": 1,
      "created_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `500` - Внутренняя ошибка сервера

### POST /api/departments
**Описание:** Создание отдела

**Требования:**
- Разрешение: `departments.create`

**Запрос:**
```json
{
  "name": "string",
  "description": "string",
  "manager_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `404` - Менеджер не найден
- `409` - Отдел с таким именем уже существует
- `500` - Внутренняя ошибка сервера

### PUT /api/departments/{id}
**Описание:** Обновление отдела

**Требования:**
- Разрешение: `departments.update`

**Запрос:**
```json
{
  "name": "string",
  "description": "string",
  "manager_id": 1
}
```

**Ответ:**
```json
{
  "id": 1,
  "name": "string",
  "description": "string",
  "manager_id": 1,
  "updated_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `404` - Отдел или менеджер не найдены
- `409` - Отдел с таким именем уже существует
- `500` - Внутренняя ошибка сервера

### DELETE /api/departments/{id}
**Описание:** Удаление отдела (soft-delete / пометка как неактивного)

**Требования:**
- Разрешение: `departments.delete`

**Ответ:**
```json
{
  "message": "success"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Отдел не найден
- `422` - Невозможно удалить отдел, есть связанные записи (например, пользователи или проекты)
- `500` - Внутренняя ошибка сервера

### GET /api/job-titles
**Описание:** Список должностей

**Требования:**
- Разрешение: `job_titles.view`

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "description": "string",
      "created_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `500` - Внутренняя ошибка сервера

### POST /api/job-titles
**Описание:** Создание должности

**Требования:**
- Разрешение: `job_titles.create`

**Запрос:**
```json
{
  "name": "string",
  "description": "string"
}
```

**Ответ:**
```json
{
  "id": 1,
  "name": "string",
  "description": "string",
  "created_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `409` - Должность с таким именем уже существует
- `500` - Внутренняя ошибка сервера

### PUT /api/job-titles/{id}
**Описание:** Обновление должности

**Требования:**
- Разрешение: `job_titles.update`

**Запрос:**
```json
{
  "name": "string",
  "description": "string"
}
```

**Ответ:**
```json
{
  "id": 1,
  "name": "string",
  "description": "string",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `404` - Должность не найдена
- `409` - Должность с таким именем уже существует
- `500` - Внутренняя ошибка сервера

### DELETE /api/job-titles/{id}
**Описание:** Удаление должности (soft-delete)

**Требования:**
- Разрешение: `job_titles.delete`

**Ответ:**
```json
{
  "message": "success"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Должность не найдена
- `422` - Невозможно удалить должность, есть связанные записи
- `500` - Внутренняя ошибка сервера

---

## 3. Управление ролями и разрешениями

### GET /api/roles
**Описание:** Список ролей

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "description": "string",
      "permissions": [],
      "created_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `500` - Внутренняя ошибка сервера

### POST /api/roles
**Описание:** Создание роли

**Запрос:**
```json
{
  "name": "string",
  "description": "string",
  "permission_ids": [1, 2, 3]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `404` - Одно или несколько разрешений не найдены
- `409` - Роль с таким именем уже существует
- `500` - Внутренняя ошибка сервера

### PUT /api/roles/{id}
**Описание:** Обновление роли

**Запрос:**
```json
{
  "name": "string",
  "description": "string",
  "permission_ids": [1, 2, 3]
}
```

### DELETE /api/roles/{id}
**Описание:** Удаление роли

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Роль не найдена
- `422` - Невозможно удалить роль, есть пользователи с этой ролью
- `500` - Внутренняя ошибка сервера

### GET /api/permissions
**Описание:** Список разрешений

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "code": "string",
      "description": "string",
      "resource": "string",
      "action": "string"
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `500` - Внутренняя ошибка сервера

### POST /api/users/{id}/roles
**Описание:** Назначение роли пользователю

**Запрос:**
```json
{
  "role_id": 1,
  "project_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Пользователь или роль не найдены
- `400` - Ошибка валидации
- `409` - Роль уже назначена пользователю
- `500` - Внутренняя ошибка сервера

### DELETE /api/users/{id}/roles/{role_id}
**Описание:** Удаление роли у пользователя

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Пользователь или роль не найдены, или роль не назначена пользователю
- `500` - Внутренняя ошибка сервера

---

## 4. Управление проектами

### GET /api/projects
**Описание:** Список проектов

**Параметры запроса:**
- `page` (int)
- `limit` (int)
- `status` (string)
- `owner_id` (int)
- `search` (string)

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "description": "string",
      "code": "string",
      "status": "string",
      "owner_id": 1,
      "created_at": "2024-01-01T00:00:00Z"
    }
  ],
  "total": 0
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации параметров
- `500` - Внутренняя ошибка сервера

### GET /api/projects/{id}
**Описание:** Получение проекта

**Ответ:**
```json
{
  "id": 1,
  "name": "string",
  "description": "string",
  "code": "string",
  "status": "string",
  "owner_id": 1,
  "stages": [],
  "created_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Проект не найден
- `500` - Внутренняя ошибка сервера

### POST /api/projects
**Описание:** Создание проекта

**Запрос:**
```json
{
  "name": "string",
  "description": "string",
  "code": "string",
  "owner_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `404` - Владелец не найден
- `409` - Проект с таким кодом уже существует
- `500` - Внутренняя ошибка сервера

### PUT /api/projects/{id}
**Описание:** Обновление проекта

**Запрос:**
```json
{
  "name": "string",
  "description": "string",
  "status": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Проект не найден
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### DELETE /api/projects/{id}
**Описание:** Удаление проекта

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Проект не найден
- `422` - Невозможно удалить проект, есть связанные записи
- `500` - Внутренняя ошибка сервера

### GET /api/projects/{id}/stages
**Описание:** Список этапов проекта

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "code": "string",
      "description": "string",
      "end_date": "2024-01-01",
      "order_index": 0
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Проект не найден
- `500` - Внутренняя ошибка сервера

### POST /api/projects/{id}/stages
**Описание:** Создание этапа

**Запрос:**
```json
{
  "name": "string",
  "code": "string",
  "description": "string",
  "end_date": "2024-01-01",
  "order_index": 0
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Проект не найден
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### PUT /api/stages/{id}
**Описание:** Обновление этапа

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Этап не найден
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### DELETE /api/stages/{id}
**Описание:** Удаление этапа

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Этап не найден
- `422` - Невозможно удалить этап, есть связанные записи
- `500` - Внутренняя ошибка сервера

---

## 5. Управление задачами

### GET /api/issues
**Описание:** Список задач

**Параметры запроса:**
- `project_id` (int)
- `status_id` (int)
- `type_id` (int)
- `assignee_id` (int)
- `priority` (string)
- `page` (int)
- `limit` (int)

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "project_id": 1,
      "title": "string",
      "description": "string",
      "status_id": 1,
      "type_id": 1,
      "priority": "string",
      "estimated_hours": 0.0,
      "start_date": "2024-01-01",
      "due_date": "2024-01-01",
      "assignee_id": 1,
      "reporter_id": 1,
      "created_at": "2024-01-01T00:00:00Z"
    }
  ],
  "total": 0
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации параметров
- `500` - Внутренняя ошибка сервера

### GET /api/issues/{id}
**Описание:** Получение задачи

**Ответ:**
```json
{
  "id": 1,
  "project_id": 1,
  "title": "string",
  "description": "string",
  "status": {},
  "type": {},
  "priority": "string",
  "estimated_hours": 0.0,
  "start_date": "2024-01-01",
  "due_date": "2024-01-01",
  "assignee": {},
  "reporter": {},
  "history": [],
  "messages": [],
  "attachments": [],
  "time_logs": [],
  "created_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Задача не найдена
- `500` - Внутренняя ошибка сервера

### POST /api/issues
**Описание:** Создание задачи

**Запрос:**
```json
{
  "project_id": 1,
  "title": "string",
  "description": "string",
  "type_id": 1,
  "priority": "string",
  "estimated_hours": 0.0,
  "start_date": "2024-01-01",
  "due_date": "2024-01-01",
  "assignee_id": 1
}
```

### PUT /api/issues/{id}
**Описание:** Обновление задачи

**Запрос:**
```json
{
  "title": "string",
  "description": "string",
  "priority": "string",
  "estimated_hours": 0.0,
  "start_date": "2024-01-01",
  "due_date": "2024-01-01",
  "assignee_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Задача не найдена
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### PUT /api/issues/{id}/status
**Описание:** Изменение статуса задачи

**Запрос:**
```json
{
  "status_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Задача или статус не найдены
- `400` - Переход между статусами не разрешен
- `500` - Внутренняя ошибка сервера

### GET /api/issues/{id}/history
**Описание:** История изменений задачи

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "field_name": "string",
      "old_value": "string",
      "new_value": "string",
      "changed_by": {},
      "created_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Задача не найдена
- `500` - Внутренняя ошибка сервера

### GET /api/issue-statuses
**Описание:** Список статусов задач

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "code": "string",
      "description": "string",
      "color": "string",
      "is_initial": false,
      "is_final": false,
      "order_index": 0
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `500` - Внутренняя ошибка сервера

### GET /api/issue-types
**Описание:** Список типов задач

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "code": "string",
      "description": "string",
      "icon": "string",
      "color": "string",
      "order_index": 0
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `500` - Внутренняя ошибка сервера

### GET /api/issue-types/{id}/workflow
**Описание:** Workflow для типа задачи

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "from_status_id": 1,
      "to_status_id": 2,
      "name": "string",
      "required_permission": "string",
      "is_active": true
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Тип задачи не найден
- `500` - Внутренняя ошибка сервера

### POST /api/issues/{id}/time-logs
**Описание:** Списание времени на задачу

**Запрос:**
```json
{
  "hours": 8.0,
  "date": "2024-01-01",
  "description": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Задача не найдена
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### GET /api/issues/{id}/time-logs
**Описание:** Список списаний времени

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "hours": 8.0,
      "date": "2024-01-01",
      "description": "string",
      "user": {},
      "created_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Задача не найдена
- `500` - Внутренняя ошибка сервера

---

## 6. Управление документами

### GET /api/documents
**Описание:** Список документов

**Параметры запроса:**
- `project_id` (int)
- `stage_id` (int)
- `status_id` (int)
- `specialization_id` (int)
- `directory_id` (int)
- `page` (int)
- `limit` (int)
- `search` (string)

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "title": "string",
      "description": "string",
      "project_id": 1,
      "stage_id": 1,
      "status_id": 1,
      "specialization_id": 1,
      "directory_id": 1,
      "created_by": {},
      "created_at": "2024-01-01T00:00:00Z"
    }
  ],
  "total": 0
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации параметров
- `500` - Внутренняя ошибка сервера

### GET /api/documents/{id}
**Описание:** Получение документа

**Ответ:**
```json
{
  "id": 1,
  "title": "string",
  "description": "string",
  "project": {},
  "stage": {},
  "status": {},
  "specialization": {},
  "directory": {},
  "created_by": {},
  "history": [],
  "attachments": [],
  "related_issues": [],
  "created_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Документ не найден
- `500` - Внутренняя ошибка сервера

### POST /api/documents
**Описание:** Создание документа

**Запрос:**
```json
{
  "title": "string",
  "description": "string",
  "project_id": 1,
  "stage_id": 1,
  "specialization_id": 1,
  "directory_id": 1
}
```

### PUT /api/documents/{id}
**Описание:** Обновление документа

**Запрос:**
```json
{
  "title": "string",
  "description": "string",
  "stage_id": 1,
  "specialization_id": 1,
  "directory_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Документ не найден
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### PUT /api/documents/{id}/status
**Описание:** Изменение статуса документа

**Запрос:**
```json
{
  "status_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Документ или статус не найдены
- `400` - Переход между статусами не разрешен
- `500` - Внутренняя ошибка сервера

### GET /api/documents/{id}/history
**Описание:** История изменений документа

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "field_name": "string",
      "old_value": "string",
      "new_value": "string",
      "changed_by": {},
      "created_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Документ не найден
- `500` - Внутренняя ошибка сервера

### GET /api/document-directories
**Описание:** Список директорий документов

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "path": "string",
      "parent_id": 1,
      "description": "string",
      "order_index": 0
    }
  ]
}
```

### POST /api/document-directories
**Описание:** Создание директории

**Запрос:**
```json
{
  "name": "string",
  "parent_id": 1,
  "description": "string",
  "order_index": 0
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `404` - Родительская директория не найдена
- `500` - Внутренняя ошибка сервера

### GET /api/document-statuses
**Описание:** Список статусов документов

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "code": "string",
      "description": "string",
      "color": "string",
      "is_initial": false,
      "is_final": false,
      "order_index": 0
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `500` - Внутренняя ошибка сервера

### POST /api/documents/{id}/issues
**Описание:** Привязка задачи к документу

**Запрос:**
```json
{
  "issue_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Документ или задача не найдены
- `400` - Ошибка валидации
- `409` - Задача уже привязана к документу
- `500` - Внутренняя ошибка сервера

### DELETE /api/documents/{id}/issues/{issue_id}
**Описание:** Отвязка задачи от документа

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Документ или задача не найдены, или связь не существует
- `500` - Внутренняя ошибка сервера

---

## 7. Управление вопросами от заказчика

### GET /api/customer-questions
**Описание:** Список вопросов

**Параметры запроса:**
- `document_id` (int)
- `project_id` (int)
- `status` (string)
- `priority` (string)
- `page` (int)
- `limit` (int)

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "document_id": 1,
      "project_id": 1,
      "question_text": "string",
      "answer_text": "string",
      "status": "string",
      "priority": "string",
      "asked_by": {},
      "answered_by": {},
      "asked_at": "2024-01-01T00:00:00Z",
      "answered_at": "2024-01-01T00:00:00Z",
      "due_date": "2024-01-01"
    }
  ],
  "total": 0
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации параметров
- `500` - Внутренняя ошибка сервера

### GET /api/customer-questions/{id}
**Описание:** Получение вопроса

**Ответ:**
```json
{
  "id": 1,
  "document": {},
  "project": {},
  "question_text": "string",
  "answer_text": "string",
  "status": "string",
  "priority": "string",
  "asked_by": {},
  "answered_by": {},
  "attachments": [],
  "asked_at": "2024-01-01T00:00:00Z",
  "answered_at": "2024-01-01T00:00:00Z",
  "due_date": "2024-01-01"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Вопрос не найден
- `500` - Внутренняя ошибка сервера

### POST /api/customer-questions
**Описание:** Создание вопроса

**Запрос:**
```json
{
  "document_id": 1,
  "project_id": 1,
  "question_text": "string",
  "priority": "string",
  "due_date": "2024-01-01"
}
```

### PUT /api/customer-questions/{id}
**Описание:** Обновление вопроса

**Запрос:**
```json
{
  "question_text": "string",
  "priority": "string",
  "due_date": "2024-01-01"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Вопрос не найден
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### PUT /api/customer-questions/{id}/answer
**Описание:** Ответ на вопрос

**Запрос:**
```json
{
  "answer_text": "string",
  "status": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Вопрос не найден
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### PUT /api/customer-questions/{id}/status
**Описание:** Изменение статуса вопроса

**Запрос:**
```json
{
  "status": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Вопрос не найден
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### GET /api/customer-question-statuses
**Описание:** Список статусов вопросов

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "code": "string",
      "description": "string",
      "color": "string",
      "is_initial": false,
      "is_final": false,
      "order_index": 0
    }
  ]
}
```

---

## 8. Управление материалами

### GET /api/materials
**Описание:** Список материалов

**Параметры запроса:**
- `category_id` (int)
- `directory_id` (int)
- `manufacturer` (string)
- `search` (string)
- `page` (int)
- `limit` (int)

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "stock_code": "string",
      "name": "string",
      "description": "string",
      "directory_id": 1,
      "unit_id": 1,
      "category_id": 1,
      "manufacturer": "string",
      "created_at": "2024-01-01T00:00:00Z"
    }
  ],
  "total": 0
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации параметров
- `500` - Внутренняя ошибка сервера

### GET /api/materials/{id}
**Описание:** Получение материала

**Ответ:**
```json
{
  "id": 1,
  "stock_code": "string",
  "name": "string",
  "description": "string",
  "directory": {},
  "unit": {},
  "category": {},
  "manufacturer": "string",
  "created_by": {},
  "created_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Материал не найден
- `500` - Внутренняя ошибка сервера

### POST /api/materials
**Описание:** Создание материала

**Запрос:**
```json
{
  "stock_code": "string",
  "name": "string",
  "description": "string",
  "directory_id": 1,
  "unit_id": 1,
  "category_id": 1,
  "manufacturer": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `404` - Директория, единица измерения или категория не найдены
- `409` - Материал с таким складским кодом уже существует
- `500` - Внутренняя ошибка сервера

### PUT /api/materials/{id}
**Описание:** Обновление материала

**Запрос:**
```json
{
  "name": "string",
  "description": "string",
  "directory_id": 1,
  "unit_id": 1,
  "category_id": 1,
  "manufacturer": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Материал не найден
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### DELETE /api/materials/{id}
**Описание:** Удаление материала

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Материал не найден
- `422` - Невозможно удалить материал, есть связанные записи
- `500` - Внутренняя ошибка сервера

### GET /api/material-categories
**Описание:** Список категорий материалов

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "code": "string",
      "description": "string",
      "parent_id": 1
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `500` - Внутренняя ошибка сервера

### GET /api/material-directories
**Описание:** Список директорий материалов

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "path": "string",
      "parent_id": 1,
      "description": "string",
      "order_index": 0
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `500` - Внутренняя ошибка сервера

### GET /api/units
**Описание:** Список единиц измерения

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "code": "string",
      "symbol": "string",
      "description": "string"
    }
  ]
}
```

---

## 9. Управление оборудованием

### GET /api/equipment
**Описание:** Список оборудования

**Параметры запроса:**
- `project_id` (int)
- `sfi_code_id` (int)
- `supplier_id` (int)
- `status` (string)
- `search` (string)
- `page` (int)
- `limit` (int)

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "equipment_code": "string",
      "name": "string",
      "description": "string",
      "sfi_code_id": 1,
      "project_id": 1,
      "supplier_id": 1,
      "manufacturer": "string",
      "model": "string",
      "serial_number": "string",
      "installation_date": "2024-01-01",
      "status": "string",
      "location": "string",
      "created_at": "2024-01-01T00:00:00Z"
    }
  ],
  "total": 0
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации параметров
- `500` - Внутренняя ошибка сервера

### GET /api/equipment/{id}
**Описание:** Получение оборудования

**Ответ:**
```json
{
  "id": 1,
  "equipment_code": "string",
  "name": "string",
  "description": "string",
  "sfi_code": {},
  "project": {},
  "supplier": {},
  "manufacturer": "string",
  "model": "string",
  "serial_number": "string",
  "installation_date": "2024-01-01",
  "status": "string",
  "location": "string",
  "technical_specifications": "string",
  "attachments": [],
  "created_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Оборудование не найдено
- `500` - Внутренняя ошибка сервера

### POST /api/equipment
**Описание:** Создание оборудования

**Запрос:**
```json
{
  "equipment_code": "string",
  "name": "string",
  "description": "string",
  "sfi_code_id": 1,
  "project_id": 1,
  "supplier_id": 1,
  "manufacturer": "string",
  "model": "string",
  "serial_number": "string",
  "installation_date": "2024-01-01",
  "status": "string",
  "location": "string",
  "technical_specifications": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `404` - SFI код, проект или поставщик не найдены
- `409` - Оборудование с таким кодом уже существует
- `500` - Внутренняя ошибка сервера

### PUT /api/equipment/{id}
**Описание:** Обновление оборудования

**Запрос:**
```json
{
  "name": "string",
  "description": "string",
  "manufacturer": "string",
  "model": "string",
  "status": "string",
  "location": "string",
  "technical_specifications": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Оборудование не найдено
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### DELETE /api/equipment/{id}
**Описание:** Удаление оборудования

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Оборудование не найдено
- `422` - Невозможно удалить оборудование, есть связанные записи
- `500` - Внутренняя ошибка сервера

### GET /api/sfi-codes
**Описание:** Список SFI кодов

**Параметры запроса:**
- `parent_id` (int)
- `level` (int)

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "code": "string",
      "name": "string",
      "description": "string",
      "parent_id": 1,
      "level": 1,
      "order_index": 0
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `500` - Внутренняя ошибка сервера

### GET /api/suppliers
**Описание:** Список поставщиков

**Параметры запроса:**
- `is_active` (boolean)
- `search` (string)

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "code": "string",
      "description": "string",
      "contact_person": "string",
      "email": "string",
      "phone": "string",
      "address": "string",
      "website": "string",
      "country": "string",
      "is_active": true
    }
  ]
}
```

### POST /api/suppliers
**Описание:** Создание поставщика

**Запрос:**
```json
{
  "name": "string",
  "code": "string",
  "description": "string",
  "contact_person": "string",
  "email": "string",
  "phone": "string",
  "address": "string",
  "website": "string",
  "country": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `409` - Поставщик с таким кодом уже существует
- `500` - Внутренняя ошибка сервера

---

## 10. Управление спецификациями и ведомостями

### GET /api/projects/{id}/specifications
**Описание:** Список спецификаций проекта

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "code": "string",
      "name": "string",
      "description": "string",
      "version": "string",
      "document_id": 1,
      "materials": [],
      "created_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Проект не найден
- `500` - Внутренняя ошибка сервера

### GET /api/specifications/{id}
**Описание:** Получение спецификации

**Ответ:**
```json
{
  "id": 1,
  "code": "string",
  "name": "string",
  "description": "string",
  "version": "string",
  "project": {},
  "document": {},
  "materials": [
    {
      "material": {},
      "quantity": 0.0,
      "notes": "string"
    }
  ],
  "created_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Спецификация не найдена
- `500` - Внутренняя ошибка сервера

### POST /api/specifications
**Описание:** Создание спецификации

**Запрос:**
```json
{
  "project_id": 1,
  "document_id": 1,
  "code": "string",
  "name": "string",
  "description": "string",
  "version": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `404` - Проект или документ не найдены
- `500` - Внутренняя ошибка сервера

### PUT /api/specifications/{id}
**Описание:** Обновление спецификации

**Запрос:**
```json
{
  "name": "string",
  "description": "string",
  "version": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Спецификация не найдена
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### POST /api/specifications/{id}/materials
**Описание:** Добавление материала в спецификацию

**Запрос:**
```json
{
  "material_id": 1,
  "quantity": 1.0,
  "notes": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Спецификация, материал или связь не найдены
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### PUT /api/specifications/{id}/materials/{material_id}
**Описание:** Обновление материала в спецификации

**Запрос:**
```json
{
  "quantity": 1.0,
  "notes": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Спецификация или материал не найдены
- `500` - Внутренняя ошибка сервера

### DELETE /api/specifications/{id}/materials/{material_id}
**Описание:** Удаление материала из спецификации

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Спецификация, материал или связь не найдены
- `500` - Внутренняя ошибка сервера

### GET /api/statements
**Описание:** Список ведомостей

**Параметры запроса:**
- `document_id` (int)
- `project_id` (int)

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "code": "string",
      "name": "string",
      "description": "string",
      "version": "string",
      "document_id": 1,
      "specifications": [],
      "created_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации параметров
- `500` - Внутренняя ошибка сервера

### GET /api/statements/{id}
**Описание:** Получение ведомости

**Ответ:**
```json
{
  "id": 1,
  "code": "string",
  "name": "string",
  "description": "string",
  "version": "string",
  "document": {},
  "specifications": [],
  "materials_summary": []
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Ведомость не найдена
- `500` - Внутренняя ошибка сервера

### POST /api/statements
**Описание:** Создание ведомости

**Запрос:**
```json
{
  "document_id": 1,
  "code": "string",
  "name": "string",
  "description": "string",
  "version": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `404` - Документ не найден
- `500` - Внутренняя ошибка сервера

### POST /api/statements/{id}/specifications
**Описание:** Добавление спецификации в ведомость

**Запрос:**
```json
{
  "specification_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Ведомость или спецификация не найдены
- `400` - Ошибка валидации
- `409` - Спецификация уже добавлена в ведомость
- `500` - Внутренняя ошибка сервера

### DELETE /api/statements/{id}/specifications/{specification_id}
**Описание:** Удаление спецификации из ведомости

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Ведомость, спецификация или связь не найдены
- `500` - Внутренняя ошибка сервера

---

## 11. Управление файлами

### POST /api/storage/upload
**Описание:** Загрузка файла

**Запрос:** multipart/form-data
- `file` (file)
- `file_category_id` (int)

**Ответ:**
```json
{
  "id": 1,
  "url": "string",
  "file_name": "string",
  "file_size": 0,
  "mime_type": "string",
  "storage_type": "string",
  "created_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации или файл не предоставлен
- `413` - Файл слишком большой
- `500` - Внутренняя ошибка сервера

### GET /api/storage/{id}
**Описание:** Получение информации о файле

**Ответ:**
```json
{
  "id": 1,
  "url": "string",
  "bucket_name": "string",
  "object_key": "string",
  "file_name": "string",
  "file_size": 0,
  "mime_type": "string",
  "storage_type": "string",
  "file_category": {},
  "uploaded_by": {},
  "created_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Файл не найден
- `500` - Внутренняя ошибка сервера

### GET /api/storage/{id}/download
**Описание:** Скачивание файла

**Ответ:** файл

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Файл не найден
- `500` - Внутренняя ошибка сервера

### DELETE /api/storage/{id}
**Описание:** Удаление файла

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Файл не найден
- `422` - Невозможно удалить файл, есть связанные записи
- `500` - Внутренняя ошибка сервера

### GET /api/storage
**Описание:** Список файлов

**Параметры запроса:**
- `file_category_id` (int)
- `storage_type` (string)
- `uploaded_by` (int)
- `page` (int)
- `limit` (int)

**Ответ:**
```json
{
  "data": [],
  "total": 0
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации параметров
- `500` - Внутренняя ошибка сервера

### POST /api/documents/{id}/attachments
**Описание:** Привязка файла к документу

**Запрос:**
```json
{
  "storage_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Документ или файл не найдены
- `400` - Ошибка валидации
- `409` - Файл уже привязан к документу
- `500` - Внутренняя ошибка сервера

### DELETE /api/documents/{id}/attachments/{storage_id}
**Описание:** Отвязка файла от документа

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Документ, файл или связь не найдены
- `500` - Внутренняя ошибка сервера

### POST /api/issues/{id}/attachments
**Описание:** Привязка файла к задаче

**Запрос:**
```json
{
  "storage_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Задача или файл не найдены
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### POST /api/equipment/{id}/attachments
**Описание:** Привязка файла к оборудованию

**Запрос:**
```json
{
  "storage_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Оборудование или файл не найдены
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### POST /api/customer-questions/{id}/attachments
**Описание:** Привязка файла к вопросу

**Запрос:**
```json
{
  "storage_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Вопрос или файл не найдены
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### GET /api/file-categories
**Описание:** Список категорий файлов

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "code": "string",
      "description": "string",
      "parent_id": 1,
      "order_index": 0
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `500` - Внутренняя ошибка сервера

---

## 12. Коммуникации

### GET /api/issues/{id}/messages
**Описание:** Список сообщений задачи

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "content": "string",
      "author": {},
      "parent_id": 1,
      "is_edited": false,
      "created_at": "2024-01-01T00:00:00Z",
      "replies": []
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Задача не найдена
- `500` - Внутренняя ошибка сервера

### POST /api/issues/{id}/messages
**Описание:** Создание сообщения к задаче

**Запрос:**
```json
{
  "content": "string",
  "parent_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Задача не найдена
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### GET /api/documents/{id}/messages
**Описание:** Список сообщений документа

**Ответ:**
```json
{
  "data": []
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Документ не найден
- `500` - Внутренняя ошибка сервера

### POST /api/documents/{id}/messages
**Описание:** Создание сообщения к документу

**Запрос:**
```json
{
  "content": "string",
  "parent_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Документ не найден
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### PUT /api/messages/{id}
**Описание:** Обновление сообщения

**Запрос:**
```json
{
  "content": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Сообщение не найдено
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### DELETE /api/messages/{id}
**Описание:** Удаление сообщения

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Сообщение не найдено
- `500` - Внутренняя ошибка сервера

### GET /api/notifications
**Описание:** Список уведомлений текущего пользователя

**Параметры запроса:**
- `notification_type` (string)
- `project_id` (int)
- `read` (boolean)
- `page` (int)
- `limit` (int)

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "notification_type": "string",
      "project_id": 1,
      "specialization_id": 1,
      "method": "string",
      "created_at": "2024-01-01T00:00:00Z"
    }
  ],
  "total": 0
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации параметров
- `500` - Внутренняя ошибка сервера

### PUT /api/notifications/{id}/read
**Описание:** Отметка уведомления как прочитанного

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Уведомление не найдено
- `500` - Внутренняя ошибка сервера

### GET /api/notifications/settings
**Описание:** Получение настроек уведомлений

**Ответ:**
```json
{
  "notification_type": "string",
  "project_id": 1,
  "specialization_id": 1,
  "method": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `500` - Внутренняя ошибка сервера

### PUT /api/notifications/settings
**Описание:** Обновление настроек уведомлений

**Запрос:**
```json
{
  "notification_type": "string",
  "project_id": 1,
  "specialization_id": 1,
  "method": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

---

## 13. Wiki

### GET /api/wiki/sections
**Описание:** Список разделов wiki

**Параметры запроса:**
- `parent_id` (int)

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "slug": "string",
      "description": "string",
      "parent_id": 1,
      "order_index": 0
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `500` - Внутренняя ошибка сервера

### GET /api/wiki/sections/{id}
**Описание:** Получение раздела

**Ответ:**
```json
{
  "id": 1,
  "name": "string",
  "slug": "string",
  "description": "string",
  "parent_id": 1,
  "order_index": 0,
  "articles": []
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Раздел не найден
- `500` - Внутренняя ошибка сервера

### POST /api/wiki/sections
**Описание:** Создание раздела

**Запрос:**
```json
{
  "name": "string",
  "slug": "string",
  "description": "string",
  "parent_id": 1,
  "order_index": 0
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `404` - Родительский раздел не найден
- `409` - Раздел с таким slug уже существует
- `500` - Внутренняя ошибка сервера

### PUT /api/wiki/sections/{id}
**Описание:** Обновление раздела

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Раздел не найден
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### DELETE /api/wiki/sections/{id}
**Описание:** Удаление раздела

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Раздел не найден
- `422` - Невозможно удалить раздел, есть статьи или подразделы
- `500` - Внутренняя ошибка сервера

### GET /api/wiki/articles
**Описание:** Список статей

**Параметры запроса:**
- `section_id` (int)
- `is_published` (boolean)
- `search` (string)
- `page` (int)
- `limit` (int)

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "title": "string",
      "slug": "string",
      "summary": "string",
      "section_id": 1,
      "is_published": false,
      "version": 1,
      "created_by": {},
      "created_at": "2024-01-01T00:00:00Z",
      "published_at": "2024-01-01T00:00:00Z"
    }
  ],
  "total": 0
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации параметров
- `500` - Внутренняя ошибка сервера

### GET /api/wiki/articles/{id}
**Описание:** Получение статьи

**Ответ:**
```json
{
  "id": 1,
  "title": "string",
  "slug": "string",
  "content": "string",
  "summary": "string",
  "section": {},
  "is_published": false,
  "version": 1,
  "created_by": {},
  "updated_by": {},
  "attachments": [],
  "created_at": "2024-01-01T00:00:00Z",
  "published_at": "2024-01-01T00:00:00Z"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Статья не найдена
- `500` - Внутренняя ошибка сервера

### POST /api/wiki/articles
**Описание:** Создание статьи

**Запрос:**
```json
{
  "title": "string",
  "slug": "string",
  "content": "string",
  "summary": "string",
  "section_id": 1
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `404` - Раздел не найден
- `409` - Статья с таким slug уже существует в разделе
- `500` - Внутренняя ошибка сервера

### PUT /api/wiki/articles/{id}
**Описание:** Обновление статьи

**Запрос:**
```json
{
  "title": "string",
  "content": "string",
  "summary": "string",
  "change_comment": "string"
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Статья не найдена
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### PUT /api/wiki/articles/{id}/publish
**Описание:** Публикация статьи

**Запрос:**
```json
{
  "is_published": true
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Статья не найдена
- `500` - Внутренняя ошибка сервера

### GET /api/wiki/articles/{id}/history
**Описание:** История версий статьи

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "version": 1,
      "title": "string",
      "content": "string",
      "summary": "string",
      "changed_by": {},
      "change_comment": "string",
      "created_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Статья не найдена
- `500` - Внутренняя ошибка сервера

### GET /api/wiki/articles/{id}/history/{version}
**Описание:** Получение конкретной версии статьи

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Статья или версия не найдены
- `500` - Внутренняя ошибка сервера

---

## 14. Справочники

### GET /api/specializations
**Описание:** Список специализаций

**Ответ:**
```json
{
  "data": [
    {
      "id": 1,
      "name": "string",
      "code": "string",
      "description": "string",
      "order_index": 0
    }
  ]
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `500` - Внутренняя ошибка сервера

### POST /api/specializations
**Описание:** Создание специализации

**Запрос:**
```json
{
  "name": "string",
  "code": "string",
  "description": "string",
  "order_index": 0
}
```

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `400` - Ошибка валидации
- `409` - Специализация с таким кодом уже существует
- `500` - Внутренняя ошибка сервера

### PUT /api/specializations/{id}
**Описание:** Обновление специализации

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Специализация не найдена
- `400` - Ошибка валидации
- `500` - Внутренняя ошибка сервера

### DELETE /api/specializations/{id}
**Описание:** Удаление специализации

**Ошибки:**
- `401` - Требуется аутентификация
- `403` - Недостаточно прав
- `404` - Специализация не найдена
- `422` - Невозможно удалить специализацию, есть связанные записи
- `500` - Внутренняя ошибка сервера

---

## Общие замечания

- Все запросы требуют аутентификации через заголовок `Authorization: Bearer {token}`
- Формат даты: ISO 8601 (`YYYY-MM-DD` или `YYYY-MM-DDTHH:mm:ssZ`)
- Пагинация: параметры `page` и `limit` для списков
- Коды ошибок: стандартные HTTP статус-коды (400, 401, 403, 404, 500)
- Формат ответов с ошибками:
```json
{
  "error": {
    "code": "string",
    "message": "string",
    "details": {}
  }
}
```

