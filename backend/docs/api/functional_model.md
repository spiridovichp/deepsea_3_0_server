# Функциональная модель системы DeepSea 3.0

## 1. Управление пользователями и авторизация

### 1.1. Управление пользователями
- **Создание пользователя**: Регистрация нового пользователя с указанием персональных данных (ФИО, email, телефон)
- **Редактирование пользователя**: Изменение данных пользователя, привязка к отделу и должности
- **Деактивация пользователя**: Блокировка доступа пользователя к системе
- **Управление отделами**: CRUD операции для отделов, назначение руководителей отделов
- **Управление должностями**: CRUD операции для справочника должностей

### 1.2. Авторизация и аутентификация
- **Авторизация пользователя**: Вход в систему по логину/паролю (Session-Based Token)
- **Обновление токена**: Обновление access token через refresh token
- **Управление сессиями**: Создание, отслеживание активности и завершение сессий
- **Выход из системы**: Завершение активной сессии пользователя

### 1.3. Управление правами доступа (RBAC)
- **Управление ролями**: CRUD операции для ролей системы
- **Управление разрешениями**: CRUD операции для разрешений с привязкой к ресурсам и действиям
- **Назначение ролей пользователям**: Привязка ролей к пользователям (глобально или в рамках проекта)
- **Управление связями роли-разрешения**: Настройка прав доступа для ролей

## 2. Управление проектами

### 2.1. Управление проектами
- **Создание проекта**: Создание нового проекта с указанием названия, описания, кода и владельца
- **Редактирование проекта**: Изменение данных проекта, статуса проекта
- **Архивирование проекта**: Перевод проекта в архивный статус
- **Просмотр проектов**: Получение списка проектов с фильтрацией и поиском

### 2.2. Управление этапами проекта
- **Создание этапа**: Добавление нового этапа проекта с указанием даты окончания
- **Редактирование этапа**: Изменение данных этапа, порядка следования
- **Удаление этапа**: Удаление этапа проекта
- **Просмотр этапов**: Получение списка этапов проекта с сортировкой

## 3. Управление задачами (Issues)

### 3.1. Управление задачами
- **Создание задачи**: Создание новой задачи с указанием типа, приоритета, исполнителя
- **Редактирование задачи**: Изменение данных задачи (название, описание, приоритет, сроки)
- **Назначение исполнителя**: Назначение/изменение исполнителя задачи
- **Изменение статуса задачи**: Переход задачи между статусами согласно workflow
- **Закрытие задачи**: Перевод задачи в финальный статус с указанием даты закрытия
- **Просмотр задач**: Получение списка задач с фильтрацией по проекту, статусу, типу, исполнителю

### 3.2. Управление типами и статусами задач
- **Управление типами задач**: CRUD операции для типов задач
- **Управление статусами задач**: CRUD операции для статусов задач (Open, In Progress, Resolved и т.д.)
- **Настройка workflow задач**: Определение допустимых переходов между статусами для каждого типа задачи
- **Управление правами на переходы**: Настройка необходимых разрешений для переходов между статусами

### 3.3. История изменений задач
- **Отслеживание изменений**: Автоматическое логирование всех изменений атрибутов задачи
- **Просмотр истории**: Получение истории изменений задачи с указанием автора и времени изменения

### 3.4. Учет времени
- **Списание времени**: Запись отработанных часов на задачу с указанием даты и описания
- **Просмотр списанного времени**: Получение статистики по списанному времени на задачу/проект/пользователя
- **Сравнение с оценкой**: Сравнение фактически списанного времени с оценкой задачи

## 4. Управление документами

### 4.1. Управление документами
- **Создание документа**: Создание нового документа с указанием названия, описания, специализации
- **Редактирование документа**: Изменение данных документа, привязка к этапу проекта
- **Изменение статуса документа**: Переход документа между статусами согласно workflow
- **Привязка к проекту и этапу**: Связывание документа с проектом и конкретным этапом
- **Привязка к специализации**: Классификация документа по специализации
- **Просмотр документов**: Получение списка документов с фильтрацией по проекту, этапу, статусу, специализации

### 4.2. Организация документов
- **Управление директориями документов**: Создание иерархической структуры папок для документов
- **Перемещение документов**: Изменение расположения документа в структуре директорий
- **Поиск документов**: Поиск документов по названию, описанию, содержимому

### 4.3. Управление статусами документов
- **Управление статусами**: CRUD операции для статусов документов
- **Настройка workflow документов**: Определение допустимых переходов между статусами документов
- **Управление правами на переходы**: Настройка необходимых разрешений для переходов между статусами

### 4.4. История изменений документов
- **Отслеживание изменений**: Автоматическое логирование всех изменений атрибутов документа
- **Просмотр истории**: Получение истории изменений документа

### 4.5. Связь документов с задачами
- **Привязка документа к задаче**: Создание связи между документом и задачей
- **Просмотр связанных задач**: Получение списка задач, связанных с документом

## 5. Управление вопросами от заказчика

### 5.1. Управление вопросами
- **Создание вопроса**: Создание нового вопроса от заказчика, связанного с документом
- **Ответ на вопрос**: Добавление ответа на вопрос с указанием отвечающего
- **Изменение статуса вопроса**: Переход вопроса между статусами (pending, answered, closed)
- **Установка приоритета**: Назначение приоритета вопроса (low, normal, high, urgent)
- **Установка срока ответа**: Указание даты, до которой должен быть дан ответ
- **Просмотр вопросов**: Получение списка вопросов с фильтрацией по статусу, приоритету, документу, проекту

### 5.2. Управление статусами вопросов
- **Управление статусами**: CRUD операции для статусов вопросов от заказчика
- **Настройка workflow вопросов**: Определение допустимых переходов между статусами вопросов
- **Управление правами на переходы**: Настройка необходимых разрешений для переходов между статусами

## 6. Управление материалами

### 6.1. Управление материалами
- **Создание материала**: Добавление нового материала с указанием складского кода, названия, производителя
- **Редактирование материала**: Изменение данных материала
- **Классификация материалов**: Привязка материала к категории и единице измерения
- **Организация материалов**: Размещение материалов в иерархической структуре директорий
- **Просмотр материалов**: Получение списка материалов с фильтрацией по категории, директории, производителю

### 6.2. Справочники материалов
- **Управление категориями материалов**: CRUD операции для категорий материалов (иерархическая структура)
- **Управление единицами измерения**: CRUD операции для единиц измерения
- **Управление директориями материалов**: Создание иерархической структуры папок для материалов

## 7. Управление оборудованием

### 7.1. Управление оборудованием
- **Создание оборудования**: Добавление нового оборудования с указанием кода, названия, модели
- **Редактирование оборудования**: Изменение данных оборудования
- **Классификация по SFI**: Привязка оборудования к коду SFI (Ship's Functional Index)
- **Привязка к проекту**: Связывание оборудования с проектом
- **Управление поставщиками**: Указание поставщика оборудования
- **Указание технических характеристик**: Добавление технических спецификаций оборудования
- **Указание местоположения**: Задание места установки оборудования
- **Просмотр оборудования**: Получение списка оборудования с фильтрацией по проекту, SFI коду, поставщику, статусу

### 7.2. Справочники оборудования
- **Управление SFI кодами**: CRUD операции для SFI классификации (иерархическая структура)
- **Управление поставщиками**: CRUD операции для поставщиков оборудования с контактной информацией

## 8. Управление спецификациями и ведомостями

### 8.1. Управление спецификациями
- **Создание спецификации**: Создание новой спецификации для проекта с указанием кода, названия, версии
- **Редактирование спецификации**: Изменение данных спецификации
- **Привязка к документу**: Связывание спецификации с документом проекта
- **Добавление материалов в спецификацию**: Привязка материалов к спецификации с указанием количества
- **Редактирование состава спецификации**: Изменение количества материалов, добавление/удаление материалов
- **Просмотр спецификаций**: Получение списка спецификаций проекта с составом материалов

### 8.2. Управление ведомостями
- **Создание ведомости**: Создание новой ведомости, объединяющей материалы из спецификаций
- **Редактирование ведомости**: Изменение данных ведомости
- **Добавление спецификаций в ведомость**: Привязка спецификаций к ведомости
- **Формирование сводной ведомости**: Автоматическое объединение материалов из всех спецификаций ведомости
- **Просмотр ведомостей**: Получение списка ведомостей проекта с составом материалов

## 9. Управление файлами и хранилищем

### 9.1. Управление файлами
- **Загрузка файлов**: Загрузка файлов в S3 хранилище с указанием категории файла
- **Скачивание файлов**: Получение файлов из хранилища по URL
- **Удаление файлов**: Удаление файлов из хранилища
- **Классификация файлов**: Привязка файлов к категориям (иерархическая структура)
- **Просмотр файлов**: Получение списка файлов с фильтрацией по категории, типу, загрузившему

### 9.2. Привязка файлов к сущностям
- **Привязка к документам**: Связывание файлов с документами
- **Привязка к задачам**: Связывание файлов с задачами
- **Привязка к оборудованию**: Связывание файлов с оборудованием
- **Привязка к вопросам**: Связывание файлов с вопросами от заказчика
- **Просмотр прикрепленных файлов**: Получение списка файлов, прикрепленных к сущности

### 9.3. Управление категориями файлов
- **Управление категориями**: CRUD операции для категорий файлов (иерархическая структура)

## 10. Коммуникации и уведомления

### 10.1. Сообщения и комментарии
- **Создание комментария**: Добавление комментария к задаче или документу
- **Ответ на комментарий**: Создание ответа на существующий комментарий (ветвление)
- **Редактирование комментария**: Изменение текста комментария с отметкой об редактировании
- **Удаление комментария**: Удаление комментария
- **Просмотр комментариев**: Получение списка комментариев к задаче/документу с поддержкой ветвления

### 10.2. Уведомления
- **Настройка уведомлений**: Настройка типов и методов уведомлений для пользователя
- **Отправка уведомлений**: Автоматическая отправка уведомлений при событиях (email, Rocket.Chat)
- **Фильтрация уведомлений**: Настройка фильтров уведомлений по проекту, специализации
- **Просмотр уведомлений**: Получение списка уведомлений пользователя

## 11. Справочники и классификаторы

### 11.1. Управление специализациями
- **Управление специализациями**: CRUD операции для справочника специализаций
- **Сортировка специализаций**: Управление порядком отображения специализаций

## 12. Аналитика и отчетность

### 12.1. Статистика по проектам
- **Статистика задач**: Количество задач по статусам, типам, приоритетам
- **Статистика времени**: Анализ списанного времени по проекту, исполнителям, задачам
- **Статистика документов**: Количество документов по статусам, специализациям, этапам
- **Статистика вопросов**: Количество вопросов по статусам, приоритетам, срокам ответа

### 12.2. Отчеты
- **Отчет по задачам**: Детальный отчет по задачам проекта с фильтрацией
- **Отчет по времени**: Отчет по списанному времени с группировкой
- **Отчет по материалам**: Отчет по материалам в спецификациях и ведомостях
- **Отчет по документам**: Отчет по документам проекта с указанием статусов

## 13. Интеграции

### 13.1. Внешние системы
- **Интеграция с Rocket.Chat**: Интеграция с системой коммуникаций
- **Интеграция с Oracle DB**: Интеграция с корпоративной базой данных Oracle


## Матрица функций и сущностей БД

| Функция | Основные таблицы БД |
|---------|---------------------|
| Управление пользователями | users, department, job_title |
| Авторизация | sessions, users |
| RBAC | roles, permissions, role_permissions, user_roles |
| Управление проектами | projects, stages |
| Управление задачами | issue, issue_status, issue_type, issue_work_flow, issue_history |
| Учет времени | time_logs, issue |
| Управление документами | documents, document_status, document_work_flow, document_directories, documents_history |
| Управление вопросами | customer_questions, customer_question_status, customer_question_work_flow |
| Управление материалами | materials, categories, units, directories |
| Управление оборудованием | equipment, sfi_codes, suppliers |
| Управление спецификациями | specification, specification_materials, statements, statements_specification |
| Управление файлами | storage, file_categories, documents_storage, issue_storage, equipment_storage, customer_questions_storage |
| Коммуникации | messages, notifications |
| Справочники | specializations |

